import{r as c}from"./vendor-CaRZ0yde.js";import{u as l,a as v,b as d}from"./query-DgI8Fk8U.js";import{ae as r}from"./index-DJzTLK63.js";const g=()=>{const a=l(),[e,s]=c.useState(null);c.useEffect(()=>{r.auth.getUser().then(({data:{user:t}})=>{s(t?.id||null)});const{data:i}=r.auth.onAuthStateChange((t,f)=>{s(f?.user?.id||null)});return()=>{i.subscription.unsubscribe()}},[]);const{data:o=[]}=v({queryKey:["favorites",e],queryFn:async()=>{if(!e)return[];const{data:i}=await r.from("storage_facility_favorites").select("facility_id").eq("user_id",e);return i?.map(t=>t.facility_id)||[]},enabled:!!e}),n=d({mutationFn:async i=>{if(!e)throw new Error("Must be logged in to favorite");const{error:t}=await r.from("storage_facility_favorites").insert({user_id:e,facility_id:i});if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["favorites",e]})}}),u=d({mutationFn:async i=>{if(!e)throw new Error("Must be logged in to unfavorite");const{error:t}=await r.from("storage_facility_favorites").delete().eq("user_id",e).eq("facility_id",i);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["favorites",e]})}});return{isAuthenticated:!!e,favorites:o,isFavorite:i=>o.includes(i),addFavorite:n.mutate,removeFavorite:u.mutate,isLoading:n.isPending||u.isPending}};export{g as u};
