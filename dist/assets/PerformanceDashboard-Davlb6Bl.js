import{j as e}from"./query-DgI8Fk8U.js";import{r as a}from"./vendor-CaRZ0yde.js";import{ae as y,H as L}from"./index-CEBhJK64.js";import"./ui-D9eRGAN1.js";import"./mapbox-X6c54b3e.js";function i(n,h){if(!n.length)return null;const c=[...n].sort((b,u)=>b-u),f=Math.floor(h/100*(c.length-1));return c[f]}const p={LCP:2500,INP:200,CLS:.1},v=({title:n,value:h,warn:c})=>e.jsxs("div",{className:`rounded-lg border p-4 ${c?"border-red-500/60":"border-[hsl(var(--border))]"} bg-[hsl(var(--background))]`,children:[e.jsx("div",{className:"text-sm text-[hsl(var(--foreground))]/70",children:n}),e.jsx("div",{className:"text-2xl font-semibold text-[hsl(var(--foreground))]",children:h})]}),k=()=>{const[n,h]=a.useState(7),[c,f]=a.useState([]),[b,u]=a.useState(!0),[g,N]=a.useState(!0),[x,C]=a.useState("all");a.useEffect(()=>{let t=!0;return(async()=>{try{u(!0);const l=new Date(Date.now()-n*24*60*60*1e3).toISOString(),{data:r,error:s}=await y.from("web_vitals").select("route,lcp_ms,inp_ms,cls,created_at,is_soft_nav,viewport_w").gte("created_at",l).order("created_at",{ascending:!1}).limit(5e3);if(s)throw s;if(!t)return;f(r||[])}catch(l){console.warn("Failed to load vitals",l)}finally{t&&u(!1)}})(),()=>{t=!1}},[n]);const d=a.useMemo(()=>{let t=c;return g||(t=t.filter(l=>!l.is_soft_nav)),x==="mobile"&&(t=t.filter(l=>(l.viewport_w??0)<768)),x==="desktop"&&(t=t.filter(l=>(l.viewport_w??0)>=768)),t},[c,g,x]),j=a.useMemo(()=>{const t=new Map;for(const r of d){const s=r.route||"(unknown)";t.has(s)||t.set(s,{lcp:[],inp:[],cls:[],count:0});const m=t.get(s);typeof r.lcp_ms=="number"&&m.lcp.push(r.lcp_ms),typeof r.inp_ms=="number"&&m.inp.push(r.inp_ms),typeof r.cls=="number"&&m.cls.push(r.cls),m.count+=1}const l=[];return t.forEach((r,s)=>{l.push({route:s,p75LCP:i(r.lcp,75),p75INP:i(r.inp,75),p75CLS:i(r.cls,75),count:r.count})}),l.sort((r,s)=>(s.p75LCP??0)-(r.p75LCP??0)),l},[d]),o=a.useMemo(()=>{const t=d.map(s=>s.lcp_ms).filter(s=>typeof s=="number"),l=d.map(s=>s.inp_ms).filter(s=>typeof s=="number"),r=d.map(s=>s.cls).filter(s=>typeof s=="number");return{p75LCP:i(t,75),p75INP:i(l,75),p75CLS:i(r,75),count:d.length}},[d]);return e.jsxs("main",{className:"min-h-screen px-4 py-8 md:px-8 bg-[hsl(var(--background))]",children:[e.jsxs(L,{children:[e.jsx("title",{children:"Site performance dashboard - core web vitals"}),e.jsx("meta",{name:"description",content:"Core web vitals performance dashboard with p75 LCP, INP, and CLS by route."}),e.jsx("link",{rel:"canonical",href:`${location.origin}/admin/perf`})]}),e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[hsl(var(--foreground))]",children:"Core web vitals performance dashboard"}),e.jsx("p",{className:"mt-2 text-[hsl(var(--foreground))]/70",children:"Real user p75 metrics across the site with budget highlights."})]}),e.jsxs("section",{className:"mb-6 flex flex-wrap items-center gap-3",children:[e.jsx("label",{className:"text-sm text-[hsl(var(--foreground))]/70",children:"Range"}),e.jsxs("select",{value:n,onChange:t=>h(Number(t.target.value)),className:"rounded-md bg-[hsl(var(--background))] border border-[hsl(var(--border))] px-3 py-2 text-[hsl(var(--foreground))]",children:[e.jsx("option",{value:1,children:"1 day"}),e.jsx("option",{value:7,children:"7 days"}),e.jsx("option",{value:14,children:"14 days"}),e.jsx("option",{value:30,children:"30 days"})]}),e.jsxs("label",{className:"ml-4 flex items-center gap-2 text-sm text-[hsl(var(--foreground))]/70",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:t=>N(t.target.checked)}),"Include soft navigations"]}),e.jsx("label",{className:"ml-4 text-sm text-[hsl(var(--foreground))]/70",children:"Device"}),e.jsxs("select",{value:x,onChange:t=>C(t.target.value),className:"rounded-md bg-[hsl(var(--background))] border border-[hsl(var(--border))] px-3 py-2 text-[hsl(var(--foreground))]",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"mobile",children:"Mobile (<768px)"}),e.jsx("option",{value:"desktop",children:"Desktop (≥768px)"})]})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-3 mb-8",children:[e.jsx(v,{title:"Sitewide p75 LCP",value:o.p75LCP!=null?`${Math.round(o.p75LCP)} ms`:"-",warn:!!(o.p75LCP&&o.p75LCP>p.LCP)}),e.jsx(v,{title:"Sitewide p75 INP",value:o.p75INP!=null?`${Math.round(o.p75INP)} ms`:"-",warn:!!(o.p75INP&&o.p75INP>p.INP)}),e.jsx(v,{title:"Sitewide p75 CLS",value:o.p75CLS!=null?o.p75CLS.toFixed(3):"-",warn:!!(o.p75CLS&&o.p75CLS>p.CLS)})]}),e.jsx("section",{children:e.jsx("div",{className:"overflow-x-auto rounded-lg border border-[hsl(var(--border))]",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-[hsl(var(--background))] text-[hsl(var(--foreground))]/70",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Route"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"p75 LCP"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"p75 INP"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"p75 CLS"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Samples"})]})}),e.jsx("tbody",{children:b?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6",colSpan:5,children:"Loading…"})}):j.length?j.map(t=>e.jsxs("tr",{className:"border-t border-[hsl(var(--border))]",children:[e.jsx("td",{className:"px-4 py-3 text-[hsl(var(--foreground))]",children:t.route}),e.jsx("td",{className:`px-4 py-3 ${t.p75LCP&&t.p75LCP>p.LCP?"text-red-400":"text-[hsl(var(--foreground))]"}`,children:t.p75LCP!=null?`${Math.round(t.p75LCP)} ms`:"-"}),e.jsx("td",{className:`px-4 py-3 ${t.p75INP&&t.p75INP>p.INP?"text-red-400":"text-[hsl(var(--foreground))]"}`,children:t.p75INP!=null?`${Math.round(t.p75INP)} ms`:"-"}),e.jsx("td",{className:`px-4 py-3 ${t.p75CLS&&t.p75CLS>p.CLS?"text-red-400":"text-[hsl(var(--foreground))]"}`,children:t.p75CLS!=null?t.p75CLS.toFixed(3):"-"}),e.jsx("td",{className:"px-4 py-3 text-[hsl(var(--foreground))]/70",children:t.count})]},t.route)):e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6",colSpan:5,children:"No data yet. Browse the site to collect RUM metrics."})})})]})})})]})};export{k as default};
