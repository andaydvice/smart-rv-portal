import{j as e}from"./query-DgI8Fk8U.js";import{r as n}from"./vendor-CaRZ0yde.js";import{ac as p,ad as T,B as w,ae as A,W as N,X as b,af as G,ag as H,ah as E,ai as R,aj as W,C,q as F,r as S,ak as P,o as D,a4 as Y,E as O,D as f,a3 as y}from"./index-DYDVLK3v.js";import{ac as J,bI as V,b0 as L,ao as $,bt as X,G as g,aa as k,bJ as K,U as Q,M as Z,b5 as U,ai as I,bK as v}from"./ui-D2SbLSSm.js";import{D as ee}from"./DashboardHeader-DLzeSoP1.js";import{u as se}from"./useFavorites-BRklezWA.js";import"./mapbox-X6c54b3e.js";const ae=()=>{const{user:a}=p(),[r,c]=n.useState(!1),[t,m]=n.useState(!!a?.user_metadata?.twofactor_enabled),[o,d]=n.useState(null),{toast:s}=T(),l=async()=>{c(!0),d(null);try{const{data:u,error:i}=await A.auth.updateUser({data:{...a?.user_metadata,twofactor_enabled:!t}});if(i){d("Failed to update 2FA settings. Please try again.");return}m(!t),s({title:t?"2FA Disabled":"2FA Enabled",description:t?"Two-factor authentication has been disabled.":"Two-factor authentication via email is now enabled for your account."})}catch(u){d(u?.message||"Failed to update 2FA settings. Please check your connection.")}finally{c(!1)}};return a?e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900/50 p-6 max-w-md mx-auto my-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[t?e.jsx(J,{className:"text-green-400 w-6 h-6 mr-2"}):e.jsx(V,{className:"text-yellow-400 w-6 h-6 mr-2"}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Two-Factor Authentication (2FA)"})]}),e.jsx("p",{className:"text-white mb-4",children:t?"Two-factor authentication is enabled for your account. You will be required to enter a 6-digit code sent to your email when signing in.":"Two-factor authentication is currently disabled. Enable this for extra account security via email OTP during login."}),o&&e.jsxs("div",{className:"flex items-center bg-red-900/20 border border-red-500/40 text-white rounded px-3 py-2 mb-3 gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm",children:o})]}),e.jsx(w,{type:"button",onClick:l,className:"w-full mt-2",disabled:r,variant:t?"destructive":"default",children:r?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin w-4 h-4 mr-2"}),"Updating..."]}):t?"Disable 2FA":"Enable 2FA"})]}):null},te=()=>{const{user:a}=p(),[r,c]=n.useState(""),[t,m]=n.useState(""),[o,d]=n.useState(""),[s,l]=n.useState(!1),[u,i]=n.useState(null),[j,M]=n.useState(0),{toast:q}=T(),z=x=>{const h=x.target.value;m(h),M(R(h))},B=async x=>{if(x.preventDefault(),t!==o){i("New passwords don't match");return}if(!E(t)){i("Password is too weak. Please use at least 8 characters with a mix of letters, numbers, and symbols.");return}l(!0),i(null);try{if(!a.email){i("User email not found");return}const{error:h}=await A.auth.signInWithPassword({email:a.email,password:r});if(h){i("Current password is incorrect");return}const{error:_}=await A.auth.updateUser({password:t});if(_){i(_.message);return}c(""),m(""),d(""),q({title:"Password Updated",description:"Your password has been successfully updated."})}catch(h){i(h.message||"An error occurred while updating the password")}finally{l(!1)}};return a?e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900/50 p-6 max-w-md mx-auto my-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(X,{className:"text-blue-400 w-6 h-6 mr-2"}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Password Management"})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"current-password",className:"text-white",children:"Current Password"}),e.jsx(b,{id:"current-password",type:"password",value:r,onChange:x=>c(x.target.value),className:"bg-[#1a2235] border-gray-700 text-white",required:!0,disabled:s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"new-password",className:"text-white",children:"New Password"}),e.jsx(b,{id:"new-password",type:"password",value:t,onChange:z,className:"bg-[#1a2235] border-gray-700 text-white",required:!0,disabled:s}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-white",children:"Password strength: "}),e.jsx("span",{className:"text-xs font-semibold text-white",children:G(j)})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${H(j)} transition-all duration-300`,style:{width:`${(j+1)*20}%`}})}),e.jsx("p",{className:"text-xs text-white mt-1",children:"Use at least 8 characters with a mix of letters, numbers, and symbols"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"confirm-password",className:"text-white",children:"Confirm New Password"}),e.jsx(b,{id:"confirm-password",type:"password",value:o,onChange:x=>d(x.target.value),className:"bg-[#1a2235] border-gray-700 text-white",required:!0,disabled:s})]}),u&&e.jsxs("div",{className:"flex items-center bg-red-900/20 border border-red-500/40 text-white rounded px-3 py-2 gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm",children:u})]}),e.jsx(w,{type:"submit",className:"w-full mt-2",disabled:s||!r||!E(t)||t!==o,children:s?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin w-4 h-4 mr-2"}),"Updating..."]}):"Update Password"})]})]}):null},re=()=>{const{history:a,deleteCalculation:r,isDeleting:c}=W(),{toast:t}=T(),m=s=>{r(s),t({title:"Calculation Deleted",description:"The saved calculation has been removed."})},o=s=>{switch(s){case"gas-calculator":return"Gas Cost Calculator";case"fuel-efficiency":return"Fuel Efficiency Calculator";case"battery-capacity":return"Battery Capacity Calculator";case"power-consumption":return"Power Consumption Calculator";case"solar-panel":return"Solar Panel Calculator";case"tire-pressure":return"Tire Pressure Optimizer";case"towing-safety":return"Towing Safety Calculator";case"weight-distribution":return"Weight Distribution Analyzer";case"rv-cost":return"RV Cost Calculator";default:return s.replace("-"," ").replace(/\b\w/g,l=>l.toUpperCase())}},d=(s,l)=>{switch(s){case"gas-calculator":return`$${l.totalCost?.toFixed(2)||"0"} (${l.gallonsNeeded?.toFixed(1)||"0"} gal)`;case"fuel-efficiency":return`${l.mpg?.toFixed(1)||"0"} MPG`;case"battery-capacity":return`${l.totalCapacity||"0"} Ah`;case"power-consumption":return`${l.totalPower||"0"} W`;case"solar-panel":return`${l.panelsNeeded||"0"} panels`;default:return JSON.stringify(l).substring(0,50)+"..."}};return a.length===0?e.jsxs(C,{className:"bg-[#091020] border-gray-700 text-white",children:[e.jsxs(F,{children:[e.jsxs(S,{className:"text-2xl text-[#60A5FA] flex items-center",children:[e.jsx(g,{className:"h-6 w-6 mr-2"}),"Saved Calculations"]}),e.jsx(P,{className:"text-gray-400",children:"Your saved calculator results will appear here"})]}),e.jsx(D,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"h-12 w-12 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"No saved calculations yet"}),e.jsxs(w,{variant:"outline",className:"border-[#60A5FA] text-[#60A5FA] hover:bg-[#60A5FA] hover:text-white",onClick:()=>window.location.href="/calculators",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Go to Calculators"]})]})})]}):e.jsxs(C,{className:"bg-[#091020] border-gray-700 text-white",children:[e.jsxs(F,{children:[e.jsxs(S,{className:"text-2xl text-[#60A5FA] flex items-center",children:[e.jsx(g,{className:"h-6 w-6 mr-2"}),"Saved Calculations (",a.length,")"]}),e.jsx(P,{className:"text-gray-400",children:"Access and manage your saved calculator results"})]}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:a.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#131a2a] rounded-lg border border-gray-700 hover:border-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(g,{className:"h-4 w-4 text-[#60A5FA]"}),e.jsx("h3",{className:"font-semibold text-white",children:o(s.calculator_type)})]}),e.jsxs("p",{className:"text-sm text-gray-400 mb-1",children:["Result: ",d(s.calculator_type,s.results)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(s.created_at).toLocaleDateString()," at"," ",new Date(s.created_at).toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",className:"border-[#60A5FA] text-[#60A5FA] hover:bg-[#60A5FA] hover:text-white",onClick:()=>window.location.href="/calculators",children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(w,{variant:"outline",size:"sm",className:"border-red-500 text-red-500 hover:bg-red-500 hover:text-white",onClick:()=>m(s.id),disabled:c,children:e.jsx(K,{className:"h-4 w-4"})})]})]},s.id))})})]})},le=()=>{const{user:a}=p();if(!a)return null;const r=a.created_at?new Date(a.created_at).toLocaleDateString():"Unknown",c=a.last_sign_in_at?new Date(a.last_sign_in_at).toLocaleDateString():"Unknown",t=!!a.user_metadata?.twofactor_enabled;return e.jsxs(C,{className:"bg-[#091020] border-gray-700 text-white",children:[e.jsxs(F,{children:[e.jsxs(S,{className:"text-2xl text-[#60A5FA] flex items-center",children:[e.jsx(Q,{className:"h-6 w-6 mr-2"}),"Account Information"]}),e.jsx(P,{className:"text-gray-400",children:"Your account details and security status"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"h-5 w-5 text-[#60A5FA]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Email"}),e.jsx("p",{className:"text-white",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-[#60A5FA]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Account Created"}),e.jsx("p",{className:"text-white",children:r})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-[#60A5FA]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Last Sign In"}),e.jsx("p",{className:"text-white",children:c})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-[#60A5FA]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Two-Factor Auth"}),e.jsx("p",{className:`font-medium ${t?"text-green-400":"text-yellow-400"}`,children:t?"Enabled":"Disabled"})]})]})]})})]})},he=()=>{const{user:a}=p(),{favorites:r}=se();return a?e.jsx("div",{className:"min-h-screen bg-[#080F1F] flex flex-col py-12 px-4",children:e.jsxs("div",{className:"w-full max-w-4xl mx-auto",children:[e.jsx(ee,{title:"Account Settings",description:"Manage your security preferences and account information"}),e.jsxs(Y,{defaultValue:"data",className:"w-full",children:[e.jsxs(O,{className:"grid grid-cols-3 mb-8",children:[e.jsxs(f,{value:"data",className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{children:"My Data"})]}),e.jsxs(f,{value:"favorites",className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:"Favorites"})]}),e.jsxs(f,{value:"security",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:"Security"})]})]}),e.jsx(y,{value:"data",children:e.jsx(re,{})}),e.jsx(y,{value:"favorites",children:e.jsxs("div",{className:"bg-[#091020] border-gray-700 text-white p-6 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(v,{className:"h-6 w-6 mr-2 text-[#60A5FA]"}),e.jsxs("h2",{className:"text-2xl font-bold text-[#60A5FA]",children:["Favorite Storage Facilities (",r.length,")"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"h-12 w-12 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"No favorite storage facilities yet"}),e.jsx("button",{className:"px-4 py-2 bg-[#60A5FA] text-white rounded hover:bg-blue-600",onClick:()=>window.location.href="/storage",children:"Browse Storage Facilities"})]}):e.jsx("div",{className:"space-y-4",children:r.map(c=>e.jsxs("div",{className:"p-4 bg-[#131a2a] rounded-lg border border-gray-600",children:[e.jsxs("p",{className:"text-white",children:["Storage Facility ID: ",c]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Enhanced facility details coming soon"})]},c))})]})}),e.jsx(y,{value:"security",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{}),e.jsx(ae,{}),e.jsx(te,{})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-start py-12",children:e.jsx("p",{className:"text-white",children:"Please log in to access account settings."})})};export{he as default};
